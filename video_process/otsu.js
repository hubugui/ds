function otsu(histogram, total) {
    var sum = 0;
    for (var i = 1; i < 256; ++i)
        sum += i * histogram[i];
    var sumB = 0;
    var wB = 0;
    var wF = 0;
    var mB;
    var mF;
    var max = 0.0;
    var between = 0.0;
    var threshold1 = 0.0;
    var threshold2 = 0.0;
    for (var i = 0; i < 256; ++i) {
        wB += histogram[i];
        if (wB == 0)
            continue;
        wF = total - wB;
        if (wF == 0)
            break;
        sumB += i * histogram[i];
        mB = sumB / wB;
        mF = (sum - sumB) / wF;
        between = wB * wF * Math.pow(mB - mF, 2);
        if ( between >= max ) {
            threshold1 = i;
            if ( between > max ) {
                threshold2 = i;
            }
            max = between;            
        }
    }
    return ( threshold1 + threshold2 ) / 2.0;
}

var histogram = new Array(
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
110, 41, 36, 120, 69, 97, 107, 91, 132, 278, 174, 167, 201, 225, 223, 461, 
257, 270, 271, 300, 290, 660, 332, 304, 357, 366, 358, 747, 369, 392, 400, 400, 
401, 745, 420, 392, 391, 394, 398, 413, 842, 408, 398, 400, 413, 426, 761, 392, 
401, 364, 387, 379, 772, 384, 336, 341, 320, 350, 641, 293, 325, 327, 314, 304, 
609, 317, 315, 316, 308, 324, 615, 302, 300, 327, 315, 302, 589, 317, 315, 313, 
339, 286, 659, 342, 265, 309, 295, 292, 550, 313, 329, 310, 334, 353, 665, 369, 
357, 416, 403, 446, 852, 433, 363, 368, 367, 336, 710, 340, 349, 341, 339, 336, 
352, 659, 333, 309, 308, 359, 269, 536, 319, 258, 301, 285, 275, 571, 251, 245, 
246, 243, 256, 457, 236, 261, 281, 252, 236, 447, 259, 253, 237, 220, 236, 478, 
254, 218, 220, 223, 222, 493, 212, 199, 214, 203, 204, 405, 200, 212, 187, 218, 
264, 393, 200, 194, 187, 200, 153, 316, 141, 120, 114, 104, 104, 163, 112, 69, 
84, 58, 69, 94, 45, 46, 45, 34, 25, 29, 50, 23, 18, 23, 10, 16, 
42, 34, 30, 30, 202, 141, 321, 97, 152, 152, 140, 154, 408, 197, 144, 153, 
272, 316, 473, 307, 371, 459, 659, 736, 1305, 717, 1225, 13901, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
);

threshold = otsu(histogram, 330*248);
console.log(threshold);